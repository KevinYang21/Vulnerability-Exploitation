##############################################################################
#   WARNING: If you change how the targets are compiled in any way, your     #
#            exploits may not work when we test them. So don't do that!      #
##############################################################################

# tools
CC := gcc
CXX := g++
RM := rm -f
CP := cp

# flags
CFLAGS := -ggdb -O1
CXXFLAGS := $(CFLAGS)
LDFLAGS :=
LDLIBS :=

# sources
objs := target1.o target2.o target3.o target4.o target5.o target6.o tmalloc.o
targets := target1 target2 target3 target4 target5 target6
installed_targets := $(addprefix /tmp/,$(targets))

# gmake magic
.PHONY:  all clean install

#targets
all: $(targets)

target6.s: target6.cc
	$(CXX) $(CXXFLAGS) -fstack-protector $(LDFLAGS) -S -o $@ $<
target6: target6.cc
	$(CXX) $(CXXFLAGS) -fstack-protector $(LDFLAGS) -o $@ $<

install: $(targets)
	sudo $(CP) $(targets) /tmp
	sudo chown root:root $(installed_targets)
	sudo chmod 04755 $(installed_targets)

clean:
	$(RM) $(targets) $(objs)
	sudo $(RM) $(installed_targets)


#dependencies
target4: tmalloc.o
tmalloc.o target4.o: tmalloc.h
